---
description: Batch process and refactor files by delegating to Gemini CLI headless agents
---

# Gemini Batch Refactor Workflow (`/gemini-batch-refactor`)

This workflow deploys the `gemini-cli-orchestrator` strategy to perform mass modifications (refactoring, translations, format standardizations) on multiple files in parallel.

## Prerequisites
- Gemini CLI must be installed and authenticated.
- The project should be version-controlled (run `git status` first).

## Standard Workflow

1. **Locate Target Files:**
   Identify the files to process. For example, all JavaScript files to migrate:
   ```bash
   find ./src -name "*.js" > target_files.txt
   ```

2. **Define the Refactoring Rule:**
   Write down precisely what needs changing in a file.
   ```bash
   echo "Convert this file to TypeScript, ensuring strict typing and keeping the exports exactly the same. Do not remove any functionality." > refactor_rules.txt
   ```

3. **Dispatch Parallel Jobs (Fan-out):**
   Use `xargs` to dispatch headless `gemini -y` jobs for every file in parallel (adjust `-P 5` for concurrency limits based on rate limits):
   ```bash
   cat target_files.txt | xargs -I {} -P 5 bash -c 'cat refactor_rules.txt | gemini -y "Refactor the file at {}"'
   ```

4. **Review Results:**
   Once all jobs complete (`wait`), review the changes using `git diff` or Jujutsu `jj diff`.
   If any files failed (subagents exit with non-zero), re-dispatch targeted instructions to those specific files.

5. **Commit Adjustments:**
   When satisfied, commit the massive diff natively generated by your CLI subagents.
