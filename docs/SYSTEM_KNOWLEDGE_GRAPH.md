# System Knowledge Graph: Overpowers Toolkit

> **Status**: Living Document
> **Purpose**: The "Cognitive Context File" for the Overpowers Agentic System.
> **Source of Truth**: Combined analysis of `AGENTS.md`, `JULES_ARCHITECTURAL_DIGEST.md`, and source code.

## 1. High-Level Architecture Diagram

```mermaid
graph TD
    User[User / Developer] -->|CLI Commands| OpenCode[OpenCode / Claude Code CLI]
    OpenCode -->|Loads| Config[Agent Configuration (JSON)]

    subgraph "Core Orchestration"
        CEO[CEO Orchestrator] -->|Delegates| Sisyphus[Sisyphus Planner]
        CEO -->|Delegates| Metis[Metis Consultant]
        Sisyphus -->|Assigns| SubAgents[Specialist Agents]
    end

    subgraph "Agent Army (400+)"
        SubAgents -->|Uses| Skills[Skills Library (900+)]
        SubAgents -->|Uses| Scripts[Helper Scripts]
    end

    subgraph "Jules Swarm (Distributed)"
        JulesLauncher[Swarm Launcher] -->|API| JulesAPI[Jules API]
        JulesAPI -->|Spawns| RemoteSessions[Remote Agent Sessions]
        RemoteSessions -->|Commit| GitHub[GitHub Repository]
    end

    subgraph "Compound Product Cycle"
        Report[Report.md] -->|Input| AutoCompound[auto-compound.sh]
        AutoCompound -->|Generates| PRD[PRD & Tasks]
        PRD -->|Loop| Loop[loop.sh]
        Loop -->|Code/Verify| Codebase
        Loop -->|Push| PR[Pull Request]
    end

    OpenCode --> CEO
    SubAgents -.->|Dispatch| JulesLauncher
    Config -.->|Generated By| GenScript[generate-agent-configs.py]

    %% Safety Layer
    Hooks[Safety Hooks] --|Intercept| ShellCommands[Shell Execution]
    ShellCommands -->|Block/Allow| System
```

## 2. Entity-Relationship Model

*   **Agent**: Defined in `agents/*.md`.
    *   *Has*: Name, Description, Category, Prompt.
    *   *Uses*: Skills, Scripts.
    *   *Generated Into*: `config/agents/*.json`.
*   **Skill**: Defined in `skills/*/SKILL.md`.
    *   *Contains*: Instructions, Executable Code (Python/Node/Bash).
    *   *Used By*: Agents to perform specific actions (e.g., "Web Research", "Code Analysis").
*   **Workflow**: Defined in `workflows/*.md`.
    *   *Describes*: A sequence of steps for complex goals.
    *   *Orchestrates*: Multiple Agents.
*   **Hook**: Defined in `hooks/`.
    *   *Triggered By*: System events (Pre-Command, Post-Commit).
    *   *Enforces*: Safety (`destructive-command-blocker`), Formatting, Notifications.
*   **Swarm Session**: Managed by `packages/jules-swarm`.
    *   *Represents*: A remote, parallel execution unit.
    *   *Context*: Git Repository + Task.

## 3. Component Registry

| Component Group | Key Path | Responsibility |
|---|---|---|
| **Root Constitution** | `AGENTS.md` | Defines Operational Laws, Protocols, and Routing Table. |
| **Architecture Doc** | `JULES_ARCHITECTURAL_DIGEST.md` | High-level system design and critical paths. |
| **Agent Generator** | `generate-agent-configs.py` | Compiles Markdown agents into CLI-compatible JSON config. |
| **Compound Cycle** | `scripts/compound/auto-compound.sh` | Automates the "Report -> PRD -> Code -> PR" product lifecycle. |
| **Swarm Core** | `packages/jules-swarm/` | Python submodule for managing distributed agent swarms via Jules API. |
| **Safety Guard** | `hooks/safety/destructive-command-blocker.ts` | Prevents catastrophic shell commands (`rm -rf /`, `mkfs`, etc.). |
| **Inventory Script** | `generate-inventory.py` | Generates markdown inventory of all assets (Agents, Skills, Scripts). |
| **Deployment Script** | `deploy-agent-army.sh` | Master script to regenerate configs and inject them into the runtime. |
| **Agents Library** | `agents/` | Source of truth for all 400+ agents. |
| **Skills Library** | `skills/` | Source of truth for all 900+ skills. |

## 4. Operational Constraints & Rules

### Protocol Zero (The Session Ledger)
*   **Rule**: Every session MUST start by reading `continuity.md` and end by updating it.
*   **Purpose**: Maintains context across stateless agent sessions.

### The Changelog Law
*   **Rule**: Every code modification MUST have a corresponding entry in `CHANGELOG.md`.
*   **Format**: Top of file, descending date.
*   **Constraint**: Never delete history.

### The Law of Explicit Declaration
*   **Rule**: Agents are not visible to the system until `generate-agent-configs.py` is run and the config is reloaded.

### Safety Constraints
*   **Forbidden**: `rm -rf /`, `rm -rf ~`, `mkfs`, `dd` to physical devices.
*   **Secrets**: Never commit API keys. Use `1password` skill or env vars.
*   **Versioning**: Do not change package versions without explicit instruction.

## 5. Health of the Codebase (Analysis)

### Observations
*   **Scale**: The codebase is massive (400+ agents, 900+ skills), indicating a high degree of specialization but potential for fragmentation.
*   **Architecture**: The separation between "Definition" (Markdown) and "Runtime" (JSON/Python) is clean and allows for easy extension.
*   **Automation**: The "Compound Product Cycle" and "Jules Swarm" indicate a high level of self-replication and autonomous capability.
*   **Documentation**: Documentation is extensive and seemingly up-to-date with the code structure.

### Discrepancies / Technical Debt
*   **Legacy Paths**: `generate-inventory.py` contains hardcoded paths (`/home/sephiroth/...`) which may fail in other environments.
*   **Duplication**: Some agent definitions (e.g., `sisyphus`) appear in multiple locations (`agents/` vs `agents/sisyphus/`), possibly due to legacy vs. modular organization.
*   **Complexity**: The sheer number of files makes manual navigation difficult; reliance on tooling (`generate-inventory.py`, `explore-grep`) is essential.
